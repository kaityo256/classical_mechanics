# 変分原理

* 汎関数微分
* オイラー・ラグランジュ方程式
* ラグランジュの未定乗数法
* フェルマーの原理
* 懸垂線
* 測地線

ニュートン力学では、ニュートンの運動方程式が出発点であり、「その運動方程式はどこから来たか」に答えることができなかった。しかし、解析力学では、最小作用の原理から運動方程式を導く。これにより、運動方程式よりも一歩引いた立場から運動を記述、理解できるようになる。最小作用の原理は、変分原理と呼ばれるものの一種である。以下では、変分原理の例としてスネルの法則、最速降下曲線、懸垂線について紹介し、これらを一般的に扱うために汎関数微分を導入する。

## スネルの法則

![スネルの法則](fig/snell.png)

まずは簡単な例からはじめよう。A地点からB地点まで行きたいとする。ただし、A地点付近は草原で歩きやすく、B地点は歩きにくい沼地の中にある。草原と沼地が直線で接しており、A地点、$B$地点から境界までの距離はそれぞれ$h_A$、$h_B$、A地点とB地点の横方向の距離は$L$であるとする。A地点からB地点まで最短で到達できる経路はどのようになるか？

草原の中、沼地の中など、歩きやすさが同じところでは、経路は直線となるであろう。従って、草原と沼地の境界にX地点をとり、その最適な場所を探すことを考える。なるべく草原を多く歩いたほうが得なのでAXを長くとりたいが、AXを長く取りすぎると全体としての経路が伸びてしまうために時間もかかる。どこかにちょうどよい点があるはずである。

この問題を考えるため、直線AXの長さを$l_A$、XBの長さを$l_B$とする。草原を歩く時の速度を$v_A$、沼地を歩く時の速度を$v_B$とする($v_A>v_B$)。A地点からX地点までの水平方向の距離を$x$とすると、X地点からB地点までの水平方向の距離は$L-x$となる。また、A地点、B地点から境界までの最短距離をそれぞれ$h_A$、$h_B$としよう。

全体を歩くのにかかる時間$T(x)$は

$$
T(x) = \frac{l_A}{v_A} + \frac{l_B}{v_B}
$$

ただし、

$$
\begin{aligned}
l_A(x) &= \sqrt{h_A^2 + x^2} \\
l_B(x) &= \sqrt{h_B^2 + (L-x)^2} \\
\end{aligned}
$$

$T(x)$を最小化する$x$は$T'(x) = 0$を満たすはずであるから、

$$
\begin{aligned}
l_A'(x) &= \frac{x}{\sqrt{h_A^2 + x^2}} = \frac{x}{l_A} \\
l_B'(x) &= \frac{-x}{\sqrt{h_B^2 + (L-x)^2}} = -\frac{L-x}{l_B}\\
\end{aligned}
$$

に注意すると、

$$
T'(x) = \frac{x}{l_A v_A} - \frac{L-x}{l_B v_B} = 0
$$

ここで、境界の法線に対して直線AX、XBのなす角をそれぞれ$\theta_A$、$\theta_B$とすると、三角関数の定義から、

$$
\begin{aligned}
\sin \theta_A &= \frac{x}{l_A} \\
\sin \theta_B &= \frac{L-x}{l_B} \\
\end{aligned}
$$

これを用いて先程の式を書き直すと、

$$
\frac{\sin \theta_A}{v_A} = \frac{\sin \theta_B}{v_B}
$$

これは、光線が平面に入射した場合、入射角と出射角(屈折角)と、その媒質中における光速との関係を表すスネルの法則にほかならない。

TODO: 変分原理とホイヘンスの原理図解？

スネルの法則は、ホイヘンスの原理によっても説明できる。ホイヘンスの原理は、波の波面から二次波とよばれる新しい波が生じ、それらが強めあうところが次の波面となる、というもので、こちらはミクロな立場から屈折を説明する。

一方、我々が求めたのは、「始点と終点が指定されている時、最も到達時間が短くなる経路」であり、これは変分原理の最も簡単な例となっている。光の場合、到達時間ではなく光路長を考えるのが一般的である。媒質中の光は真空中よりも速度が遅くなる。そこで、真空中での光速を媒質中の光速で割ったものを、その媒質の屈折率と呼ぶ。真空中での光速を$c$とすると、屈折率$n_A$を持つ媒質Aの中での速度$v_A$は、屈折率の定義から

$$
v_A = \frac{c}{n_A}
$$

となる。これを用いると、A地点からB地点への光の到達時間$T$は

$$
T = \frac{n_A l_A + n_B l_B}{c}
$$

となる。すなわち、実際の長さ$l_A$に対して、光が感じる実効的な長さは$n_A l_A$となっている。屈折率が大きい媒質であるほど光の速度は遅くなるため、光にとってその媒質は「進みにくい」物質となる。つまり、屈折率が大きいほど、光は実際の長さよりも長く感じることになる。この、実際の長さに屈折率をかけたものを光路長と呼び、光は光路長の総和を最小(停留)にするような経路を進む。これをフェルマーの原理と呼ぶ。

もちろん光には意思はないため、異なる媒質に入射する前に「なるべく光路長を短くする経路を選ぼう」などとは思っていない。しかし、最終的に光が通った経路を見ると、それは始点と終点を決めた時に、もっとも光路長が短くなるように選ばれている。このように、何かの総和が最も小さくなるように経路などが決まると主張するのが変分原理である。ホイヘンスの原理が、ある瞬間の光の振る舞いに着目し、次の瞬間の光の位置を逐次的に決めていく形であるのに対して、変分原理は全体を見渡し、光の経路を一度に決めてしまう。このように、変分原理は全体を俯瞰する立場から振る舞いを決定する見方を与える。

## 最速降下曲線

変分原理の有名な例として、最速降下曲線を考えよう。斜面に質点をそっと置いて離し、重力により滑らせる。ただし、摩擦は無視できるものとする。質点は斜面から離れることなく、なめらかに滑るとしよう。スタート地点とゴール地点を固定する時、もっとも早くゴールするような斜面はどのような形状であるか求めよ、というものが最速降下曲線の問題である。この問題はベルヌーイが解いて、数学者への挑戦という形で出題された。しばらく誰も解くことができなかったが、ニュートンがこれを一晩で解いて返送し、ベルヌーイが悔しがった、というのは有名な話である。

![座標軸](fig/bc_coordinate.png)

問題を解くため、まず座標軸を設定しよう。質点を置く場所を原点にとる。最速降下曲線は下に落下していく問題だが、重力の働く方向を$y$軸の正の向きにとる。

さて、最速降下「曲線」というくらいだから答えは曲線となるのだが、これを折れ線で近似しよう。

![折れ線近似](fig/bc_snell.png)

運動の始点を原点にとり、終点を$(L, H)$の場所に取ろう。$L$を$N$等分し、左から$k$番目の場所を$x_k$とする。位置$x_k$から$x_{k+1}$までは速度が一定であると近似し、その速度を$v_k$としよう。

位置$x_k$における斜面の位置を$y_k$とすると、エネルギー保存則より

$$
\frac{1}{2} m{v_k}^2 = mgy_k
$$

が成り立つ。従って、

$$
v(x_k) = \sqrt{2gy_k}
$$

また、位置$x_k$から$x+\Delta x$における曲線の長さ$l(x_k)$は

$$
\begin{aligned}
l(x_k) &=\sqrt{\Delta x^2 + (y_{k+1} - y_k)^2} \\
&\sim \Delta x \sqrt{1 + (y'_k)^2} \\
\end{aligned}
$$

ただし、$y_{k+1} - y_k = y(x_k+\Delta x) - y(x_k) = y'_k \Delta x + O(\Delta x^2)$を用いた。

かかる時間の総和は

$$
T = \sum_{k=0}^{N-1} \frac{l(x_k)}{v(x_k)} \Delta x
$$

であるから、$N$に関して連続極限をとれば、

$$
\begin{aligned}
T &= \int_0^L \frac{l(x)}{v(x)} dx \\
&= \int_0^L \frac{\sqrt{1+y'^2}}{\sqrt{2gy}} dx
\end{aligned}
$$

関数$y(x)$は、スカラー量を入力とし、スカラー量を返すものであった。先程の$T$は関数$y(x)$を入力とし、出力としてスカラー量が決まるため、「関数の関数」とみなすことができる。それを表現して$T[y]$と書くことがある。境界条件のもとで$T[y]$を最小とするような関数$y(x)$を見つけよ、というのが最速降下曲線問題である。

この問題を、汎関数微分を用いて解くというのが本章の目的だが、まずは物理的な考察で解いてみよう。曲線を折れ線で近似した状態を考える。$x_{k-1}$から$x_k$までの領域の速度は$v_{k-1}$であり、$x_k$から$x_{k+1}$までの速度が$v_k$であるから、入射角$\theta_{k-1}$と出射角$\theta_k$を定義するとスネルの法則と同じ議論により

$$
\frac{\sin \theta_{k-1}}{v_{k-1}} = \frac{\sin \theta_k}{v_k} 
$$

連続極限をとると、

$$
\frac{\sin \theta}{v} = C
$$

が場所に依らず成り立つ。ただし$C$は定数である。傾きと三角関数の定義から

$$
\begin{aligned}
\frac{dy}{dx} &= \tan\left(\frac{\pi}{2} - \theta \right) \\
&= - \frac{\cos \theta}{\sin \theta} \\
&= - \frac{\sqrt{1-\sin^2 \theta}}{\sin \theta}
\end{aligned}
$$

$\sin \theta = v C = C \sqrt{2gy}$を代入して整理すると、

$$
\frac{dy}{dx} = - \sqrt{\frac{2a - y}{y}}
$$

となる。ただし$a = 1/(4gC^2)$である。これを真面目に解いてみよう。

$y = 2au$と変数変換すると、

$$
\frac{du}{dx} = - \frac{1}{2a} \sqrt{\frac{1-u}{u}}
$$

さらに

$$
\tan \frac{s}{2} = \sqrt{\frac{u}{1-u}}
$$

と変数変換すると、半角公式

$$
\tan^2 \frac{s}{2} = \frac{1 - \cos s}{1  + \cos s}
$$

を用いて、ただちに

$$
u = \frac{1 + \cos s}{2}
$$

と求まる。両辺を微分すると

$$
\begin{aligned}
du &= - \frac{\sin s}{2} ds \\
&= - \sin \frac{s}{2} \cos \frac{s}{2} ds
\end{aligned}
$$

$$
du = - \frac{1}{2a} \frac{\cos \frac{s}{2}}{\sin \frac{s}{2}} dx
$$

であったから、$du$を消去して、

$$
\begin{aligned}
dx &= 2a \sin^2 \frac{s}{2} ds \\
&= a (1 - \cos s) ds
\end{aligned}
$$

両辺積分すると、

$$
x = a (x-\sin s)
$$

$y$と合わせて、以下の媒介変数表示での解を得る。

$$
\begin{aligned}
x &= a (s-\cos s) \\
y &= a (1 + \cos s) \\
\end{aligned}
$$

これはサイクロイド曲線を表現している。

## 懸垂線

変分原理の題材のもう一つの例として、懸垂線を挙げよう。一様な重力下で紐の両端を持ち、少し緩める。この時、紐はどのような形になるであろうか。

TODO: 力の釣り合い

これは電信柱の間の電線が作る形状でもある。

## 汎関数微分

## 変分原理

## オイラー・ラグランジュ方程式

